{% extends 'layouts/base.html' %}
{% block head %}
<script type='text/javascript'
    src='https://platform-api.sharethis.com/js/sharethis.js#property=5e86e668b4e52f001290ee85&product=inline-share-buttons'
    async='async'></script>
{% endblock %}


{% block content %}
<div class="idea-details">

    <!-- Edit idea: only visible for idea owner and admin -->
    {% if (idea.username == session["username"]) or (session["username"] == "Master") %}
    <div class="idea-details__edit-idea">
        <div class="idea-details__edit-idea--item">
            <a href="{{url_for('edit_idea', idea_id=idea._id)}}" class="waves-effect waves-light btn-secundary">edit
                idea</a>
        </div>
        <div class="idea-details__edit-idea--item">
            <a href="{{url_for('delete_idea', idea_id=idea._id)}}" class="waves-effect waves-light btn-secundary">delete
                idea</a>
        </div>
    </div>
    {% endif %}

    <h1>{{idea.idea_title}}</h1>
    <img class="image-container__detail" src="{{ url_for('file', filename=idea.image_name) }}" max-width="800"
        height="300">

    <!-- Edit image: only visible for idea owner and admin -->
    {% if (idea.username == session["username"]) or (session["username"] == "Master") %}
    <div class="idea-details__edit-image">
        <a class="modal-trigger btn-secundary idea-details__edit-image--item" href="#modal1">Edit
            picture</a>
    </div>
    {% endif %}

    <div class="divider"></div>

    <div class="grid-wrapper">

        <div class="idea-details__votes">
            <div class="idea-details__votes__fr1">
                <i class="material-icons">thumb_up</i>
            </div>
            <div class="idea-details__votes__fr2">
                <p>{{idea.total_votes}}</p>
            </div>
            <div class="idea-details__votes__fr3">
                <i class="material-icons">visibility</i>
            </div>
            <div class="idea-details__votes__fr4">
                <p>{{idea.views}}</p>
            </div>
            <div class="idea-details__votes__row2--left">
                votes
            </div>
            <div class="idea-details__votes__row2--right">
                views
            </div>
        </div>
    </div>
    {% set ns = namespace(found=false) %}
    {% for user_vote in idea.user_votes %}
    {% if session["username"] == user_vote %}
    {% set cannotVoteAgain=true %}
    {% set ns.found = true %}
    {% endif %}
    {% endfor %}

    {% if ns.found == true %}
    <form action="{{ url_for('downvote_idea', idea_id=idea._id) }}" method="POST">
        <div class="idea-details__cta">
            <button class="btn-secundary waves-effect waves-light idea-details__cta--btn" type="submit" name="action">
                Remove my vote
            </button>
        </div>
    </form>
    {% else %}
    <form action="{{ url_for('upvote_idea', idea_id=idea._id) }}" method="POST">
        <div class="idea-details__cta">
            <button class=" btn waves-effect waves-light idea-details__cta--btn" type="submit" name="action">
                Like this idea!
            </button>
        </div>
    </form>
    {% endif %}
    <div class="sharethis">
        <h6>Do you really like this idea? Ask your friends to like it too!</h6>
    </div>

    <div class="sharethis-inline-share-buttons"></div>

    <div class="divider"></div>

    <p>Details: {{idea.idea_details}}</p>



    <div class="divider"></div>

    <div class="idea-details__category">
        <h6 class="idea-details__category--title">Category:</h6>
        <div class="idea-details__category--item">
            {{idea.category_name}}
        </div>
    </div>

    <div class="idea-details__tags">
        <h6 class="idea-details__tags--title">Tags:</h6>
        <div class="idea-details__tags--row2">
            <div class="idea-details__tags--row2--item">
                {{idea.idea_tag1}}
            </div>
            <div class="idea-details__tags--row2--item">
                {{idea.idea_tag2}}
            </div>
            <div class="idea-details__tags--row2--item">
                {{idea.idea_tag3}}
            </div>
        </div>
    </div>



    <div class="divider divider__bottom-margin"></div>

    <div class="idea-details__secundary grey-text">
        <div class="idea-details__secundary--date">
            <p>Date added:</p>
            <p>{{idea.date_added}}</p>
        </div>
        <div class=idea-details__secundary--owner">
            <p>Submitted by:</p>
            <p>{{idea.username}}</p>
        </div>
    </div>

    <!-- Modal Structure -->
    <div id="modal1" class="modal">
        <div class="modal-content">
            <h4>Edit picture</h4>
            <form action="{{ url_for('insert_image', idea_id=idea._id) }}" method="POST" class="col s12"
                enctype="multipart/form-data">
                <div class="input-field col s12">
                    <input type="file" name="image" id="image">
                </div>
                <div class="modal-footer">
                    <button class="btn waves-effect waves-light" type="submit">Save new picture</button>
                    <a href="{{url_for('idea_details', idea_id=idea._id)}}"
                        class="waves-effect waves-light btn-secundary">cancel</a>
                </div>
            </form>
        </div>
    </div>

    {% endblock %}